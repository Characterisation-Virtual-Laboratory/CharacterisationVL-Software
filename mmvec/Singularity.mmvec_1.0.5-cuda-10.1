Bootstrap: shub
From: Characterisation-Virtual-Laboratory/CharacterisationVL-Software:1804-cuda10.1

%environment
    PATH=/opt/conda/bin:$PATH
    export PATH
    source activate /opt/conda/envs/qiime2-2020.6
    export LC_ALL=C.UTF-8
    export LANG=C.UTF-8


%post
    export LC_ALL=C.UTF-8
    export LANG=C.UTF-8
    apt update -y
    apt  install -y build-essential
    apt install -y git curl vim wget tar bzip2 gzip 
    wget https://repo.continuum.io/miniconda/Miniconda3-latest-Linux-x86_64.sh
    bash Miniconda3-latest-Linux-x86_64.sh -b -p /opt/conda
    export PATH=/opt/conda/bin:$PATH
    conda install -y conda
    conda update -y conda
    wget https://data.qiime2.org/distro/core/qiime2-2020.6-py36-linux-conda.yml
    conda env create -n qiime2-2020.6 --file qiime2-2020.6-py36-linux-conda.yml
    /bin/bash
    source activate /opt/conda/envs/qiime2-2020.6
    pip install numpy
    pip install git+https://github.com/biocore/mmvec.git
    pip install tensorflow-gpu<=1.14.0
    qiime dev refresh-cache

%runscript
    exec qiime "$@"
